# 🚀 Исправление проблемы с API в продакшене

## 🚨 Проблема: API возвращает HTML вместо JSON

Ошибка `Unexpected token '<', "<!doctype "...` означает, что API запросы возвращают HTML страницу вместо JSON.

## 🔧 Что было исправлено

### 1. **Обновлен server.js**
- ✅ Добавлена поддержка статических файлов для продакшена
- ✅ Добавлен обработчик для всех остальных маршрутов
- ✅ Добавлен импорт path модуля

### 2. **Обновлен vercel.json**
- ✅ Упрощена конфигурация сборки
- ✅ Добавлен maxDuration для функций
- ✅ Все маршруты направляются на server.js

## 🚀 Следующие шаги

### 1. **Пересоберите проект**
```bash
npm run build
```

### 2. **Передеплойте на Vercel**
```bash
vercel --prod
```

### 3. **Проверьте переменные окружения**
Убедитесь, что на Vercel установлены все переменные:
- `NODE_ENV=production`
- `REACT_APP_API_URL=https://your-domain.vercel.app`
- `FRONTEND_URL=https://your-domain.vercel.app`
- `OPENAI_API_KEY=your-key`
- `REACT_APP_OPENAI_API_KEY=your-key`
- `REACT_APP_OPEN_ROUTER_API_KEY=your-key`

### 4. **Добавьте домен в Firebase**
1. Перейдите в [Firebase Console](https://console.firebase.google.com/)
2. Выберите проект `careerbloom-fp61e`
3. Authentication → Settings → Authorized domains
4. Добавьте ваш Vercel домен

## 🧪 Тестирование

### 1. **Проверка API endpoints**
```bash
curl https://your-domain.vercel.app/api/search?q=test
```

### 2. **Проверка фронтенда**
- Откройте сайт в браузере
- Попробуйте выполнить поиск
- Проверьте консоль браузера на ошибки

### 3. **Проверка логов**
- Проверьте логи в Vercel Dashboard
- Убедитесь, что сервер запускается без ошибок

## 🚨 Если проблема остается

### 1. **Проверьте логи Vercel**
- Перейдите в Vercel Dashboard → Functions
- Проверьте логи server.js функции

### 2. **Проверьте переменные окружения**
- Убедитесь, что все переменные установлены
- Проверьте, что значения корректны

### 3. **Проверьте сборку**
- Убедитесь, что папка `build` создается при `npm run build`
- Проверьте, что все файлы присутствуют

### 4. **Альтернативное решение**
Если проблема остается, попробуйте:
1. Создать отдельный API проект на Vercel
2. Разделить фронтенд и бэкенд
3. Использовать Railway или Heroku для API

## 📞 Поддержка

Если проблема остается:
1. Проверьте логи Vercel Functions
2. Убедитесь, что все зависимости установлены
3. Проверьте, что server.js запускается локально с `NODE_ENV=production`
















